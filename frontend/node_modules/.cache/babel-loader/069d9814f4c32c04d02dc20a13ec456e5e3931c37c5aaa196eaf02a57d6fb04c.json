{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{Link}from'react-router-dom';import styles from'./CartPage.module.scss';import{CartContext}from'../../../context/CartContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CartPage=()=>{const[cart,setCart]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[isAgreementChecked,setIsAgreementChecked]=useState(false);const{updateCartCount}=useContext(CartContext);const fetchCart=async()=>{try{const response=await fetch('http://localhost:8000/api/cart/',{headers:{'Authorization':\"Token \".concat(localStorage.getItem('token'))}});if(!response.ok){throw new Error('Failed to fetch cart');}const data=await response.json();setCart(Array.isArray(data)?data[0]:data);updateCartCount(Array.isArray(data)?data[0].items.length:data.items.length);}catch(error){console.error('Error fetching cart:',error);setError(error.message);}finally{setLoading(false);}};useEffect(()=>{fetchCart();},[]);const removeFromCart=async itemId=>{try{const response=await fetch(\"http://localhost:8000/api/cart/remove/\".concat(itemId,\"/\"),{method:'DELETE',headers:{'Authorization':\"Token \".concat(localStorage.getItem('token'))}});if(!response.ok){throw new Error('Failed to remove item from cart');}await fetchCart();}catch(error){console.error('Error removing item from cart:',error);setError(error.message);}};const calculateTotal=()=>{if(!cart||!cart.items)return 0;return cart.items.reduce((total,item)=>{const itemPrice=parseFloat(item.price)||0;return total+itemPrice;},0).toFixed(2);};const handleAgreementChange=event=>{setIsAgreementChecked(event.target.checked);};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"});if(error)return/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \",error]});if(!cart||!cart.items||cart.items.length===0)return/*#__PURE__*/_jsx(\"div\",{children:\"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430 \\u043F\\u0443\\u0441\\u0442\\u0430.\"});return/*#__PURE__*/_jsxs(\"div\",{className:styles.cartPage,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\"}),/*#__PURE__*/_jsxs(\"div\",{className:styles.cartContainer,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.cartSummary,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.summaryLeft,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.totalPrice,children:[\"\\u0422\\u043E\\u0432\\u0430\\u0440\\u043E\\u0432 \\u043D\\u0430 \\u0441\\u0443\\u043C\\u043C\\u0443: \",calculateTotal(),\" \\u0440\\u0443\\u0431.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.totalItems,children:[\"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0442\\u043E\\u0432\\u0430\\u0440\\u043E\\u0432: \",cart.items.length,\" \\u0448\\u0442.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.summaryRight,children:[/*#__PURE__*/_jsx(\"button\",{className:styles.checkoutButton,disabled:!isAgreementChecked,children:\"\\u041F\\u0435\\u0440\\u0435\\u0439\\u0442\\u0438 \\u043A \\u043E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u0438\\u044E\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.agreement,children:/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"agreement\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"agreement\",checked:isAgreementChecked,onChange:handleAgreementChange}),\"\\u041F\\u0440\\u043E\\u0434\\u043E\\u043B\\u0436\\u0430\\u044F \\u043E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u0438\\u0435 \\u044F \\u0441\\u043E\\u0433\\u043B\\u0430\\u0448\\u0430\\u044E\\u0441\\u044C \\u0441\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Link,{className:styles.privacyPolicyLink,to:\"/offer-agreement\",children:\"\\u0434\\u043E\\u0433\\u043E\\u0432\\u043E\\u0440\\u043E\\u043C \\u043E\\u0444\\u0435\\u0440\\u0442\\u044B\"}),\".\"]})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:styles.cartItems,children:cart.items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:styles.cartItem,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.cartItemImage,children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.id),children:item.images&&item.images.length>0?/*#__PURE__*/_jsx(\"img\",{src:item.images[0].image,alt:item.title,onError:e=>{e.target.onerror=null;e.target.src='https://via.placeholder.com/100';}}):/*#__PURE__*/_jsx(\"img\",{src:\"https://via.placeholder.com/100\",alt:item.title})})}),/*#__PURE__*/_jsxs(\"div\",{className:styles.cartItemDetails,children:[/*#__PURE__*/_jsx(\"h2\",{children:item.title}),/*#__PURE__*/_jsxs(\"div\",{className:styles.cartItemPrice,children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0426\\u0435\\u043D\\u0430: \",item.price,\" \\u0440\\u0443\\u0431.\"]}),/*#__PURE__*/_jsx(\"button\",{className:styles.removeButton,onClick:()=>removeFromCart(item.id),children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})]})]})]},item.id))})]})]});};export default CartPage;","map":{"version":3,"names":["React","useEffect","useState","useContext","Link","styles","CartContext","jsx","_jsx","jsxs","_jsxs","CartPage","cart","setCart","loading","setLoading","error","setError","isAgreementChecked","setIsAgreementChecked","updateCartCount","fetchCart","response","fetch","headers","concat","localStorage","getItem","ok","Error","data","json","Array","isArray","items","length","console","message","removeFromCart","itemId","method","calculateTotal","reduce","total","item","itemPrice","parseFloat","price","toFixed","handleAgreementChange","event","target","checked","children","className","cartPage","cartContainer","cartSummary","summaryLeft","totalPrice","totalItems","summaryRight","checkoutButton","disabled","agreement","htmlFor","type","id","onChange","privacyPolicyLink","to","cartItems","map","cartItem","cartItemImage","images","src","image","alt","title","onError","e","onerror","cartItemDetails","cartItemPrice","removeButton","onClick"],"sources":["/home/kiipod/projects/slwrm/frontend/src/pages/ShopPage/CartPage/CartPage.jsx"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport { Link } from 'react-router-dom';\nimport styles from './CartPage.module.scss';\nimport { CartContext } from '../../../context/CartContext';\n\nconst CartPage = () => {\n  const [cart, setCart] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [isAgreementChecked, setIsAgreementChecked] = useState(false);\n  const { updateCartCount } = useContext(CartContext);\n\n  const fetchCart = async () => {\n    try {\n      const response = await fetch('http://localhost:8000/api/cart/', {\n        headers: {\n          'Authorization': `Token ${localStorage.getItem('token')}`\n        }\n      });\n      if (!response.ok) {\n        throw new Error('Failed to fetch cart');\n      }\n      const data = await response.json();\n      setCart(Array.isArray(data) ? data[0] : data);\n      updateCartCount(Array.isArray(data) ? data[0].items.length : data.items.length);\n    } catch (error) {\n      console.error('Error fetching cart:', error);\n      setError(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchCart();\n  }, []);\n\n  const removeFromCart = async (itemId) => {\n    try {\n      const response = await fetch(`http://localhost:8000/api/cart/remove/${itemId}/`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Token ${localStorage.getItem('token')}`\n        }\n      });\n      if (!response.ok) {\n        throw new Error('Failed to remove item from cart');\n      }\n      await fetchCart();\n    } catch (error) {\n      console.error('Error removing item from cart:', error);\n      setError(error.message);\n    }\n  };\n\n  const calculateTotal = () => {\n    if (!cart || !cart.items) return 0;\n    return cart.items.reduce((total, item) => {\n      const itemPrice = parseFloat(item.price) || 0;\n      return total + itemPrice;\n    }, 0).toFixed(2);\n  };\n\n  const handleAgreementChange = (event) => {\n    setIsAgreementChecked(event.target.checked);\n  };\n\n  if (loading) return <div>Загрузка...</div>;\n  if (error) return <div>Ошибка: {error}</div>;\n  if (!cart || !cart.items || cart.items.length === 0) return <div>Корзина пуста.</div>;\n\n  return (\n    <div className={styles.cartPage}>\n      <h1>Корзина</h1>\n      <div className={styles.cartContainer}>\n        <div className={styles.cartSummary}>\n          <div className={styles.summaryLeft}>\n            <div className={styles.totalPrice}>Товаров на сумму: {calculateTotal()} руб.</div>\n            <div className={styles.totalItems}>Количество товаров: {cart.items.length} шт.</div>\n          </div>\n          <div className={styles.summaryRight}>\n            <button className={styles.checkoutButton} disabled={!isAgreementChecked}>\n              Перейти к оформлению\n            </button>\n            <div className={styles.agreement}>\n              <label htmlFor=\"agreement\">\n                <input\n                  type=\"checkbox\"\n                  id=\"agreement\"\n                  checked={isAgreementChecked}\n                  onChange={handleAgreementChange}\n                />\n                Продолжая оформление я соглашаюсь с\n                <br />\n                <Link className={styles.privacyPolicyLink} to=\"/offer-agreement\">договором оферты</Link>.\n              </label>\n            </div>\n          </div>\n        </div>\n        <div className={styles.cartItems}>\n          {cart.items.map(item => (\n            <div key={item.id} className={styles.cartItem}>\n              <div className={styles.cartItemImage}>\n                <Link to={`/product/${item.id}`}>\n                  {item.images && item.images.length > 0 ? (\n                    <img src={item.images[0].image} alt={item.title} onError={(e) => {\n                      e.target.onerror = null;\n                      e.target.src = 'https://via.placeholder.com/100';\n                    }} />\n                  ) : (\n                    <img src='https://via.placeholder.com/100' alt={item.title} />\n                  )}\n                </Link>\n              </div>\n              <div className={styles.cartItemDetails}>\n                <h2>{item.title}</h2>\n                <div className={styles.cartItemPrice}>\n                  <p>Цена: {item.price} руб.</p>\n                  <button className={styles.removeButton} onClick={() => removeFromCart(item.id)}>Удалить</button>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CartPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}