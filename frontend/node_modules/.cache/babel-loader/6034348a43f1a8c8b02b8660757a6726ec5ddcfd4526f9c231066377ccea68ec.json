{"ast":null,"code":"import React,{useState,useEffect}from'react';import styles from'../../../components/ChatButton/ModalChat/ModalChat.module.scss';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ModalVIPChat=_ref=>{let{onClose}=_ref;const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');useEffect(()=>{const token=localStorage.getItem('token');if(token){const fetchMessages=async()=>{const response=await fetch('http://localhost:8000/api/vip-messages/',{headers:{'Authorization':\"Token \".concat(token)}});if(response.ok){const data=await response.json();setMessages(data);}else{console.error('Failed to fetch messages');}};fetchMessages();const intervalId=setInterval(fetchMessages,5000);return()=>clearInterval(intervalId);}},[]);const addMessage=message=>{setMessages(prevMessages=>[...prevMessages,message]);};const handleSendMessage=async e=>{e.preventDefault();const token=localStorage.getItem('token');const response=await fetch('http://localhost:8000/api/vip-messages/create/',{method:'POST',headers:{'Authorization':\"Token \".concat(token),'Content-Type':'application/json'},body:JSON.stringify({content:newMessage,is_admin:false})});if(response.ok){const data=await response.json();addMessage(data);setNewMessage('');// Сброс текста в поле ввода\n}else{console.error('Failed to send message');}};const handleKeyDown=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage(e);}};return/*#__PURE__*/_jsx(\"div\",{className:styles.modalOverlay,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.modal,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.modalHeader,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0427\\u0430\\u0442 \\u0434\\u043B\\u044F \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u043E\\u0432 \\u043C\\u0430\\u0441\\u0442\\u0435\\u0440-\\u043A\\u043B\\u0430\\u0441\\u0441\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.modalButton,onClick:onClose,children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"div\",{className:styles.chatWindow,children:messages.map((message,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(styles.message,\" \").concat(message.is_admin?styles.adminMessage:styles.userMessage),children:[/*#__PURE__*/_jsxs(\"strong\",{children:[message.user,\":\"]}),\" \",message.content,/*#__PURE__*/_jsx(\"div\",{className:styles.timestamp,children:new Date(message.timestamp).toLocaleString()})]},index))}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,children:[/*#__PURE__*/_jsx(\"textarea\",{value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyDown:handleKeyDown,placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0432\\u0430\\u0448\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435...\",required:true}),/*#__PURE__*/_jsx(\"button\",{className:styles.modalButtonSend,type:\"submit\",children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]})]})});};export default ModalVIPChat;","map":{"version":3,"names":["React","useState","useEffect","styles","jsx","_jsx","jsxs","_jsxs","ModalVIPChat","_ref","onClose","messages","setMessages","newMessage","setNewMessage","token","localStorage","getItem","fetchMessages","response","fetch","headers","concat","ok","data","json","console","error","intervalId","setInterval","clearInterval","addMessage","message","prevMessages","handleSendMessage","e","preventDefault","method","body","JSON","stringify","content","is_admin","handleKeyDown","key","shiftKey","className","modalOverlay","children","modal","modalHeader","modalButton","onClick","chatWindow","map","index","adminMessage","userMessage","user","timestamp","Date","toLocaleString","onSubmit","value","onChange","target","onKeyDown","placeholder","required","modalButtonSend","type"],"sources":["/home/kiipod/projects/slwrm/frontend/src/pages/MarenGarden/VIPModalChat/ModalVIPChat.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport styles from '../../../components/ChatButton/ModalChat/ModalChat.module.scss';\n\nconst ModalVIPChat = ({ onClose }) => {\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      const fetchMessages = async () => {\n        const response = await fetch('http://localhost:8000/api/vip-messages/', {\n          headers: {\n            'Authorization': `Token ${token}`\n          }\n        });\n        if (response.ok) {\n          const data = await response.json();\n          setMessages(data);\n        } else {\n          console.error('Failed to fetch messages');\n        }\n      };\n      fetchMessages();\n\n      const intervalId = setInterval(fetchMessages, 5000);\n      return () => clearInterval(intervalId);\n    }\n  }, []);\n\n  const addMessage = (message) => {\n    setMessages(prevMessages => [...prevMessages, message]);\n  };\n\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n    const token = localStorage.getItem('token');\n    const response = await fetch('http://localhost:8000/api/vip-messages/create/', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Token ${token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ content: newMessage, is_admin: false })\n    });\n    if (response.ok) {\n      const data = await response.json();\n      addMessage(data);\n      setNewMessage('');  // Сброс текста в поле ввода\n    } else {\n      console.error('Failed to send message');\n    }\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage(e);\n    }\n  };\n\n  return (\n    <div className={styles.modalOverlay}>\n      <div className={styles.modal}>\n        <div className={styles.modalHeader}>\n          <h2>Чат для участников мастер-класса</h2>\n          <div className={styles.modalButton} onClick={onClose}>Закрыть</div>\n        </div>\n        <div className={styles.chatWindow}>\n          {messages.map((message, index) => (\n            <div key={index} className={`${styles.message} ${message.is_admin ? styles.adminMessage : styles.userMessage}`}>\n              <strong>{message.user}:</strong> {message.content}\n              <div className={styles.timestamp}>{new Date(message.timestamp).toLocaleString()}</div>\n            </div>\n          ))}\n        </div>\n        <form onSubmit={handleSendMessage}>\n          <textarea\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            onKeyDown={handleKeyDown}\n            placeholder=\"Введите ваше сообщение...\"\n            required\n          />\n          <button className={styles.modalButtonSend} type=\"submit\">Отправить</button>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default ModalVIPChat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}